{
  "schema_name": "schema.def.v1",
  "title": "Agent Definition Schema",
  "tags": [
    "schema:definition",
    "system:bootstrap",
    "defines:agent.def.v1"
  ],
  "context": {
    "defines_schema": "agent.def.v1",
    "category": "agents",
    "field_definitions": {
      "agent_id": {
        "type": "string",
        "required": true,
        "description": "Unique identifier for the agent"
      },
      "system_prompt": {
        "type": "string",
        "required": true,
        "description": "LLM system instructions"
      },
      "context_sources": {
        "type": "object",
        "required": false,
        "description": "Declares what context to augment graph with - processed by context-builder",
        "properties": {
          "always": {
            "type": "array",
            "description": "Always include these breadcrumbs (tool catalog, browser context, etc)",
            "items": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["schema", "tag", "specific"],
                  "description": "How to find this context source"
                },
                "schema_name": {
                  "type": "string",
                  "description": "Schema to fetch (if type=schema)"
                },
                "tag": {
                  "type": "string",
                  "description": "Tag to search (if type=tag)"
                },
                "method": {
                  "type": "string",
                  "enum": ["latest", "recent", "all"],
                  "default": "latest",
                  "description": "How to fetch breadcrumbs"
                },
                "limit": {
                  "type": "number",
                  "default": 1,
                  "description": "Maximum breadcrumbs to fetch"
                },
                "optional": {
                  "type": "boolean",
                  "default": false,
                  "description": "Don't fail if not found"
                },
                "reason": {
                  "type": "string",
                  "description": "Documentation: why this source is needed"
                }
              },
              "required": ["type"]
            }
          },
          "semantic": {
            "type": "object",
            "description": "Semantic search configuration for knowledge retrieval",
            "properties": {
              "enabled": {
                "type": "boolean",
                "default": false,
                "description": "Enable semantic search for knowledge"
              },
              "schemas": {
                "type": "array",
                "items": {"type": "string"},
                "description": "Which schemas to search (e.g., knowledge.v1, note.v1)"
              },
              "limit": {
                "type": "number",
                "default": 3,
                "description": "Maximum knowledge breadcrumbs"
              },
              "min_similarity": {
                "type": "number",
                "default": 0.75,
                "description": "Minimum similarity score (0.0-1.0)"
              }
            }
          }
        }
      },
      "subscriptions": {
        "type": "object",
        "required": true,
        "description": "Event subscriptions - should ONLY contain triggers (context fetching handled by context_sources)",
        "properties": {
          "selectors": {
            "type": "array",
            "description": "Subscription selectors - use role=trigger ONLY",
            "items": {
              "properties": {
                "schema_name": "string",
                "all_tags": "array of strings",
                "any_tags": "array of strings",
                "context_match": "array of match rules",
                "role": "enum[trigger] - NO LONGER USE role=context",
                "key": "string",
                "fetch": "object"
              }
            }
          }
        }
      }
    }
  },
  "description": "Agent definition schema with context_sources for unified context assembly",
  "semantic_version": "2.0.0",
  "llm_hints": {
    "mode": "exclude"
  }
}

