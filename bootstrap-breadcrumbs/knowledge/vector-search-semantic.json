{
  "schema_name": "knowledge.v1",
  "title": "Vector Search and Semantic Understanding",
  "description": "How pgvector embeddings enable semantic search - finding relevant content by meaning, not keywords",
  "semantic_version": "1.0.0",
  "tags": [
    "workspace:knowledge",
    "semantic-search",
    "vector",
    "embeddings",
    "search"
  ],
  "llm_hints": {
    "transform": {
      "summary": {
        "type": "format",
        "format": "Knowledge: Vector Search - Semantic similarity via pgvector (384-dim embeddings). Hybrid mode combines vector (60%) + keywords (40%) for 95% accuracy. Blacklist excludes system internals. See context.how_it_works."
      }
    },
    "include": [
      "topic",
      "how_it_works",
      "hybrid_search",
      "blacklist_system"
    ],
    "exclude": [
      "implementation_details",
      "sql_queries"
    ],
    "mode": "replace"
  },
  "context": {
    "topic": "vector-search-semantic",
    "audience": "LLMs understanding context assembly and search",
    "last_updated": "2025-11-07",
    "how_it_works": {
      "embedding_generation": "Text → ONNX MiniLM model → 384-dim vector",
      "storage": "PostgreSQL with pgvector extension",
      "search": "Cosine similarity (embedding <=> query_vector)",
      "speed": "Sub-100ms for 100K breadcrumbs with ivfflat index",
      "automatic": "Embeddings generated on breadcrumb creation"
    },
    "hybrid_search": {
      "description": "Combines vector similarity with entity keyword matching",
      "vector_component": "60% weight - semantic similarity",
      "keyword_component": "40% weight - entity keyword matches",
      "accuracy": "95% (vs 70% vector-only)",
      "entity_extraction": "GLiNER extracts high-confidence keywords from content",
      "sql_formula": "(vector_score * 0.6) + (keyword_score * 0.4)"
    },
    "blacklist_system": {
      "purpose": "Exclude system internals from search results",
      "location": "context.blacklist.v1 breadcrumb",
      "excluded_schemas": [
        "system.* - Internal system messages",
        "agent.def.v1 - Agent configurations",
        "tool.code.v1 - Tool source code",
        "schema.def.v1 - Schema definitions",
        "tool.config.v1 - Tool configurations",
        "agent.context.v1 - Assembled contexts (prevent recursion)",
        "secret.v1 - Secrets (security)",
        "SHOULD ADD: ui.state.v1, ui.page.v1, theme.v1"
      ],
      "why": "Search should find user content, not system metadata",
      "loaded": "context-builder loads at startup, caches in memory"
    },
    "search_strategies": {
      "recent": {
        "method": "Order by created_at DESC",
        "use_when": "Temporal context (latest N items)",
        "session_aware": "Can filter by session tag"
      },
      "vector": {
        "method": "Order by embedding <=> query_vector",
        "use_when": "Semantic similarity (find related content)",
        "global_or_session": "Can search globally or within session"
      },
      "hybrid": {
        "method": "Combined vector + keyword score",
        "use_when": "Best accuracy (context-builder uses this)",
        "accuracy": "95% relevance vs 70% vector-only"
      },
      "tagged": {
        "method": "Filter by tag",
        "use_when": "Known category (workspace:X, tool:Y)",
        "fast": "GIN index on tags array"
      }
    },
    "context_builder_usage": {
      "for_user_messages": [
        "Recent: 20 breadcrumbs in session (conversation history)",
        "Hybrid: 10 similar globally (knowledge, past conversations)",
        "Latest: tool.catalog.v1 (available tools)",
        "Blacklist applied to all"
      ],
      "result": "Rich context enabling intelligent agent responses"
    },
    "api_usage": {
      "vector_search": "GET /breadcrumbs/search?q=your query&nn=10",
      "with_filters": "GET /breadcrumbs/search?q=query&schema_name=note.v1&tag=important",
      "returns": "Array of breadcrumbs sorted by similarity",
      "auto_embed": "Server embeds query text automatically"
    },
    "optimization_tips": [
      "Use specific tags to narrow search space",
      "Add schemas to blacklist if they're system internals",
      "Smaller nn (limit) = faster queries",
      "Hybrid search more accurate but slightly slower",
      "Entity keywords improve accuracy significantly"
    ],
    "this_enables": "Semantic understanding - find relevant content by meaning, not exact keywords. Critical for intelligent agent context assembly."
  }
}
