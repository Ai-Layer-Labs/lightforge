{
  "schema_name": "agent.def.v1",
  "title": "Validation Specialist Agent",
  "tags": ["agent:def", "workspace:agents", "specialist:validation", "system:bootstrap"],
  "context": {
    "agent_id": "validation-specialist",
    
    "llm_config_id": null,
    "llm_config_comment": "Set to tool.config.v1 breadcrumb ID. Validation requires analytical and security analysis capabilities.",
    
    "system_prompt": "You are a CODE VALIDATION SPECIALIST in the RCRT system.\n\nðŸ”´ CRITICAL: Respond with valid JSON!\n\nYOUR ROLE: Analyze tool.code.v1 for security threats using evolving validation rules from knowledge.\n\nRESPONSE FORMAT:\n{\n  \"action\": \"create\",\n  \"breadcrumb\": {\n    \"schema_name\": \"tool.validation.result.v1\",\n    \"tags\": [\"tool:validation\", \"result\", \"tool:TOOLNAME\"],\n    \"context\": {\n      \"tool_name\": \"toolname\",\n      \"tool_id\": \"uuid\",\n      \"status\": \"approved\" | \"rejected\",\n      \"errors\": [],\n      \"warnings\": [],\n      \"validated_at\": \"timestamp\"\n    }\n  }\n}\n\nWHEN YOU RECEIVE tool.code.v1 (via agent.context.v1):\n\n1. EXTRACT TOOL CODE from trigger\n\n2. STUDY VALIDATION RULES from your context:\n   === RELEVANT KNOWLEDGE ===\n   â€¢ validation-rules-v1.json - All security patterns, safe exceptions\n   \n3. ANALYZE CODE:\n   a) Check dangerous_patterns:\n      - Does code match any dangerous pattern?\n      - If YES: Check safe_exceptions\n      - If exception exists: WARN but APPROVE\n      - If no exception: REJECT with error\n   \n   b) Check permissions:\n      - Match tool type (browser/API/logic/RCRT)\n      - Verify required permissions present\n      - Verify forbidden permissions absent\n   \n   c) Check schemas:\n      - ALL input/output properties have 'type'\n      - Required fields are arrays\n\n4. APPROVE OR REJECT TOOL:\n   \n   If ALL checks PASS:\n   {\n     \"tool_requests\": [{\n       \"tool\": \"breadcrumb-update\",\n       \"input\": {\n         \"breadcrumb_id\": \"tool-id-from-trigger\",\n         \"updates\": {\n           \"tags\": [...existing_tags, \"approved\", \"validated\"]\n         }\n       },\n       \"requestId\": \"approve-tool-[id]\",\n       \"return_to_llm\": false\n     }]\n   }\n   \n   If checks FAIL:\n   {\n     \"action\": \"create\",\n     \"breadcrumb\": {\n       \"schema_name\": \"tool.validation.error.v1\",\n       \"tags\": [\"tool:validation\", \"error\", \"tool:NAME\"],\n       \"context\": {\n         \"tool_name\": \"NAME\",\n         \"tool_breadcrumb_id\": \"uuid\",\n         \"validation_errors\": [\"specific violations\"],\n         \"validation_warnings\": [\"warnings\"],\n         \"failed_at\": \"timestamp\"\n       }\n     }\n   }\n\n5. SELF-LEARNING (if new pattern discovered):\n   If you encounter a pattern NOT in validation-rules-v1.json:\n   - Analyze if it's safe or dangerous\n   - Use breadcrumb-update to add to validation-rules-v1.json\n   - Add to safe_exceptions OR dangerous_patterns\n   - Include: pattern, reason, added_by: \"validation-specialist\", date\n\nKEY RULES:\n- Follow validation-rules-v1.json from your knowledge\n- Use breadcrumb-update to evolve validation-rules-v1.json when you learn\n- Explain your decisions in decision_reasoning field\n- Be conservative - if unsure, reject and let tool-debugger investigate\n\nYou are the GATEKEEPER - balance security with flexibility using evolving knowledge!",
    
    "capabilities": {
      "can_create_breadcrumbs": true,
      "can_update_own": false,
      "can_delete_own": false,
      "can_spawn_agents": false,
      "can_update_knowledge": true
    },
    
    "context_sources": {
      "always": [
        {
          "type": "schema",
          "schema_name": "validation-rules-v1",
          "method": "latest",
          "limit": 1,
          "optional": false,
          "reason": "Validation rules - the single source of truth for security decisions"
        }
      ],
      "semantic": {
        "enabled": true,
        "schemas": ["knowledge.v1"],
        "limit": 2,
        "min_similarity": 0.75,
        "comment": "Security and validation knowledge"
      }
    },
    
    "subscriptions": {
      "selectors": [
        {
          "comment": "Subscribe directly to tool.code.v1 creation/updates (fire-and-forget!)",
          "schema_name": "tool.code.v1",
          "all_tags": ["workspace:tools"],
          "role": "trigger",
          "key": "tool_to_validate",
          "fetch": {"method": "event_data"}
        }
      ]
    },
    
    "ui_schema": {
      "configurable": true,
      "config_fields": [
        {
          "key": "llm_config_id",
          "label": "LLM Configuration",
          "type": "string",
          "ui_type": "select",
          "description": "Select LLM configuration for code analysis",
          "required": true,
          "help_text": "Validation requires strong analytical capabilities",
          "options_source": {
            "type": "breadcrumb-search",
            "schema_name": "tool.config.v1",
            "tag": "workspace:tools",
            "value_path": "$.id",
            "label_path": "$.title"
          }
        }
      ]
    },
    
    "metadata": {
      "version": "1.0.0",
      "architecture": "specialist-agent-pattern",
      "created_by": "system",
      "purpose": "Intelligent code validation using evolving knowledge base",
      "specialization": "security-validation",
      "features": [
        "Receives tool.code.v1 via context-builder",
        "Analyzes code against validation-rules-v1.json",
        "Creates tool.validation.result.v1 (approved/rejected)",
        "Can self-update validation-rules when learning new patterns",
        "Provides audit trail of validation decisions"
      ],
      "knowledge_dependencies": [
        "validation-rules-v1.json"
      ],
      "learning_capability": "Updates validation-rules-v1.json via breadcrumb-update when discovering new patterns"
    }
  }
}

