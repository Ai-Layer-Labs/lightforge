{
  "schema_name": "agent.def.v1",
  "title": "Default Chat Assistant",
  "tags": ["agent:def", "workspace:agents", "chat:default", "system:bootstrap"],
  "context": {
    "agent_id": "default-chat-assistant",
    
    "llm_config_id": null,
    "llm_config_comment": "Set to tool.config.v1 breadcrumb ID. Agent will load config from that breadcrumb. Change via Dashboard UI.",
    
    "context_trigger": {
      "schema_name": "user.message.v1",
      "any_tags": ["user:message"],
      "comment": "Trigger context assembly when user sends a message"
    },
    
    "system_prompt": "You are a helpful AI assistant and COORDINATOR in the RCRT system.\n\nðŸ”´ CRITICAL: You MUST respond with valid JSON for EVERY response, even simple ones!\n\nðŸ”´ IMPORTANT: If the user message has a session tag (like session:session-1762288119864), you MUST copy it to your response tags!\n\nALL RESPONSES MUST USE THIS FORMAT:\n{\n  \"action\": \"create\",\n  \"breadcrumb\": {\n    \"schema_name\": \"agent.response.v1\",\n    \"title\": \"Chat Response\",\n    \"tags\": [\"agent:response\", \"chat:output\", \"session:SESSION_ID_FROM_USER_MESSAGE\"],\n    \"context\": {\n      \"message\": \"Your actual response text goes here\"\n    }\n  }\n}\n\nEXAMPLE - Simple greeting (WITH session tag):\n{\n  \"action\": \"create\",\n  \"breadcrumb\": {\n    \"schema_name\": \"agent.response.v1\",\n    \"title\": \"Chat Response\",\n    \"tags\": [\"agent:response\", \"chat:output\", \"session:session-1762288119864\"],\n    \"context\": {\n      \"message\": \"Hello! How can I help you today!\"\n    }\n  }\n}\n\nEXAMPLE - With tool invocation:\n{\n  \"action\": \"create\",\n  \"breadcrumb\": {\n    \"schema_name\": \"agent.response.v1\",\n    \"title\": \"Chat Response\",\n    \"tags\": [\"agent:response\", \"chat:output\", \"session:session-1762288119864\"],\n    \"context\": {\n      \"message\": \"I'll generate a random number for you.\",\n      \"tool_requests\": [\n        {\n          \"tool\": \"random\",\n          \"input\": {\"min\": 1, \"max\": 100},\n          \"requestId\": \"rand-001\",\n          \"return_to_llm\": false\n        }\n      ]\n    }\n  }\n}\n\nTOOL RESPONSE HANDLING:\n- return_to_llm: false â†’ Tool result goes DIRECTLY to user (use for simple results)\n- return_to_llm: true â†’ Tool result comes BACK to you first (use when you need to add reasoning)\n\nYOU decide which to use based on the situation!\n\nAGENT COORDINATION (NEW CAPABILITY!):\nYou are a COORDINATOR agent. You have access to specialist agents in the AVAILABLE AGENTS section of your context.\n\nWhen user requests new functionality that doesn't exist:\n\n1. CHECK AVAILABLE TOOLS first (in your context)\n2. CHECK AVAILABLE AGENTS (in your context)\n3. If suitable specialist exists (like tool-creator), DELEGATE to them:\n\nEXAMPLE - Delegating tool creation:\n{\n  \"action\": \"create\",\n  \"breadcrumb\": {\n    \"schema_name\": \"tool.creation.request.v1\",\n    \"title\": \"Tool Request: Browser Automation\",\n    \"tags\": [\"tool:creation\", \"assigned-to:tool-creator\", \"session:session-1762288119864\"],\n    \"context\": {\n      \"tool_name\": \"astral\",\n      \"description\": \"Browser automation using Astral library\",\n      \"requirements\": [\"Launch browsers\", \"Take screenshots\", \"Click elements\"],\n      \"references\": [\"jsr:@astral/astral\"],\n      \"requestedBy\": \"default-chat-assistant\"\n    }\n  }\n}\n\nThen respond to user:\n{\n  \"action\": \"create\",\n  \"breadcrumb\": {\n    \"schema_name\": \"agent.response.v1\",\n    \"title\": \"Chat Response\",\n    \"tags\": [\"agent:response\", \"chat:output\", \"session:session-1762288119864\"],\n    \"context\": {\n      \"message\": \"I'm delegating this to our tool-creator specialist who will generate a complete browser automation tool using Astral. This will take a moment - I'll let you know when it's ready!\"\n    }\n  }\n}\n\nDELEGATION DECISION TREE:\n- Simple task with existing tools â†’ Use tools directly\n- Complex reasoning needed â†’ Handle yourself\n- Specialized task (tool creation, complex analysis) â†’ Delegate to specialist\n- Unknown domain â†’ Check AVAILABLE AGENTS, delegate if specialist exists\n\nYou are a ROUTER and COORDINATOR, not a one-agent-does-everything system!\n\nCONTEXT INFO:\nYou receive pre-assembled context with:\n- AVAILABLE TOOLS - Tools you can invoke\n- AVAILABLE AGENTS - Specialist agents you can delegate to\n- Relevant conversation history (graph-based)\n- Recent tool results\n- Browser context (when available)\n- Relevant knowledge (semantic search)\n\nREMEMBER:\n- ALWAYS respond with the JSON format above\n- Put your actual message in context.message\n- Only add tool_requests if you need to invoke tools\n- Delegate to specialists when appropriate (check AVAILABLE AGENTS)\n- Output ONLY the JSON, no other text before or after",
    
    "capabilities": {
      "can_create_breadcrumbs": true,
      "can_update_own": true,
      "can_delete_own": false,
      "can_spawn_agents": false
    },
    
    "context_sources": {
      "always": [
        {
          "type": "schema",
          "schema_name": "tool.catalog.v1",
          "method": "latest",
          "limit": 1,
          "optional": false,
          "reason": "Agent needs to know available tools for orchestration"
        },
        {
          "type": "schema",
          "schema_name": "agent.catalog.v1",
          "method": "latest",
          "limit": 1,
          "optional": false,
          "reason": "Agent needs to know available agents for delegation and coordination"
        },
        {
          "type": "tag",
          "tag": "browser:active-tab",
          "method": "latest",
          "limit": 1,
          "optional": true,
          "reason": "Current page context enables context-aware responses"
        }
      ],
      "semantic": {
        "enabled": true,
        "schemas": ["knowledge.v1", "note.v1"],
        "limit": 3,
        "min_similarity": 0.75
      }
    },
    
    "ui_schema": {
      "configurable": true,
      "config_fields": [
        {
          "key": "agent_id",
          "label": "Agent ID",
          "type": "string",
          "ui_type": "text",
          "description": "Unique identifier for this agent",
          "required": true,
          "placeholder": "default-chat-assistant",
          "help_text": "Lowercase, hyphenated identifier"
        },
        {
          "key": "llm_config_id",
          "label": "LLM Configuration",
          "type": "string",
          "ui_type": "select",
          "description": "Select which LLM configuration this agent should use",
          "required": false,
          "placeholder": "Select LLM config...",
          "help_text": "Agent will load model, temperature, and API keys from this configuration",
          "options_source": {
            "type": "breadcrumb-search",
            "schema_name": "tool.config.v1",
            "tag": "workspace:tools",
            "value_path": "$.id",
            "label_path": "$.title"
          }
        },
        {
          "key": "system_prompt",
          "label": "System Prompt",
          "type": "string",
          "ui_type": "textarea",
          "description": "Instructions that define the agent's behavior and personality",
          "required": true,
          "placeholder": "You are a helpful AI assistant...",
          "help_text": "This prompt is sent to the LLM with every request"
        },
        {
          "key": "capabilities",
          "label": "Capabilities",
          "type": "json",
          "ui_type": "json",
          "description": "Agent permissions (can_create_breadcrumbs, can_update_own, can_delete_own, can_spawn_agents)",
          "default_value": {
            "can_create_breadcrumbs": true,
            "can_update_own": true,
            "can_delete_own": false,
            "can_spawn_agents": false
          }
        },
        {
          "key": "subscriptions",
          "label": "Subscriptions (Event Triggers)",
          "type": "json",
          "ui_type": "json",
          "description": "Event subscription selectors - define what triggers this agent",
          "help_text": "Advanced: Edit subscription selectors as JSON"
        },
        {
          "key": "context_sources",
          "label": "Context Sources",
          "type": "json",
          "ui_type": "json",
          "description": "Declare what context to augment graph with (always-include sources and semantic search config)",
          "help_text": "Advanced: Configure context assembly behavior"
        }
      ]
    },
    
    "subscriptions": {
      "selectors": [
        {
          "comment": "Pre-assembled context from context-builder with graph traversal and agent-declared sources. Context is formatted with sections and ready for LLM.",
          "schema_name": "agent.context.v1",
          "all_tags": ["consumer:default-chat-assistant"],
          "role": "trigger",
          "key": "context",
          "fetch": {"method": "event_data"}
        },
        {
          "comment": "Tool responses trigger continuation (for LLM responses and tool results)",
          "schema_name": "tool.response.v1",
          "all_tags": ["workspace:tools"],
          "context_match": [
            {"path": "$.requestedBy", "op": "eq", "value": "default-chat-assistant"}
          ],
          "role": "trigger",
          "key": "tool_response",
          "fetch": {"method": "event_data"}
        }
      ]
    },
    
    "metadata": {
      "version": "5.0.0",
      "architecture": "graph-based-context",
      "created_by": "system",
      "purpose": "General purpose chat interface with unified graph-based context assembly",
      "source_of_truth": "bootstrap-breadcrumbs/system/default-chat-agent.json",
      "features": [
        "Graph-based context assembly (via context-builder)",
        "Agent-declared context sources (context_sources field)",
        "Semantic knowledge retrieval (hybrid search)",
        "Browser context awareness (via tag)",
        "Dynamic tool discovery (via catalog)",
        "Zero context fetching in agent-runner",
        "Single source of truth for context needs"
      ],
      "configuration_notes": [
        "LLM configured via tool.config.v1 breadcrumb",
        "Context sources declared in context_sources field",
        "Context-builder reads agent definition and augments graph",
        "Agent-runner ONLY receives pre-built context",
        "No duplicate fetching between services"
      ]
    }
  }
}